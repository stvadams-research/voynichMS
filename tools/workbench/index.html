<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voynich Tool Workbench</title>
  <link rel="stylesheet" href="css/app.css">
</head>
<body>
  <header class="app-header">
    <div>
      <h1>Voynich Tool Workbench</h1>
      <p>Standalone offline toolkit for slips, lattice, folio exploration, IVTFF validation, and synthetic generation.</p>
      <p class="muted compact-note">Canonical source across tools: ZL3b-n.txt / <code>source_id="zandbergen_landini"</code>.</p>
    </div>
  </header>

  <nav class="app-nav" id="app-nav">
    <button class="nav-btn active" data-route="slips">Slips</button>
    <button class="nav-btn" data-route="lattice">Lattice</button>
    <button class="nav-btn" data-route="explorer">Folio Explorer</button>
    <button class="nav-btn" data-route="validator">IVTFF Validator</button>
    <button class="nav-btn" data-route="folio">Folio Generator</button>
    <button class="nav-btn" data-route="page">Page Generator</button>
  </nav>

  <main class="app-main">
    <section class="view active" id="view-slips">
      <div class="two-col">
        <div class="panel">
          <h2>Mechanical Slips</h2>
          <p class="muted compact-note">Why it matters: highlights likely line-to-line eye-slip events as direct mechanical evidence.</p>
          <p class="muted" id="slips-status">Loading embedded slip dataset...</p>
          <div class="scroll-list" id="slips-list"></div>
        </div>
        <div class="panel">
          <h2>Slip Context</h2>
          <p class="muted" id="slips-empty">Select a slip from the list.</p>
          <div id="slips-detail" class="hidden">
            <div class="subpanel">
              <h3>Line N-1 (Source)</h3>
              <div id="slip-prev-line" class="token-row"></div>
            </div>
            <div class="subpanel">
              <h3>Line N (Observed)</h3>
              <div id="slip-curr-line" class="token-row"></div>
            </div>
            <div class="subpanel note" id="slip-meta"></div>
          </div>
        </div>
      </div>
    </section>

    <section class="view" id="view-lattice">
      <div class="two-col">
        <div class="panel">
          <h2>Lattice Windows</h2>
          <p class="muted compact-note">Why it matters: interact with the inferred state machine and observe deterministic transitions.</p>
          <p class="muted" id="lattice-status">Loading lattice model...</p>
          <div class="actions compact">
            <button id="lattice-reset">Reset</button>
            <button id="lattice-random">Random Window</button>
          </div>
          <div class="scroll-list" id="window-list"></div>
        </div>
        <div class="panel">
          <h2>Window <span id="lattice-window-label">0</span> Tokens</h2>
          <div id="window-words" class="word-grid"></div>
          <h3>Output Trace</h3>
          <div id="lattice-output" class="output-box"></div>
        </div>
      </div>
    </section>

    <section class="view" id="view-explorer">
      <div class="two-col">
        <div class="panel">
          <h2>Folio Explorer</h2>
          <p class="muted compact-note">Why it matters: browse canonical ZL3b folios and push them directly into validation.</p>
          <p class="muted" id="explorer-status">Loading ZL3b folio index...</p>
          <div class="actions">
            <label>Find Folio
              <input id="explorer-filter" type="text" placeholder="e.g., f42r">
            </label>
          </div>
          <div class="scroll-list" id="explorer-folio-list"></div>
        </div>
        <div class="panel">
          <h2 id="explorer-folio-title">Select a folio</h2>
          <div class="scan-panel">
            <a id="explorer-scan-link" href="#" class="scan-link disabled-link">
              <img id="explorer-scan-thumb" alt="Folio thumbnail">
            </a>
            <div id="explorer-scan-meta" class="muted">No scan mapped for selected folio.</div>
          </div>
          <div class="actions">
            <button id="explorer-send-content">Send Content To Validator</button>
            <button id="explorer-send-full">Send Full IVTFF Lines To Validator</button>
          </div>
          <div id="explorer-line-list" class="explorer-lines"></div>
        </div>
      </div>
    </section>

    <section class="view" id="view-validator">
      <div class="panel">
        <h2>IVTFF Validator</h2>
        <p class="muted compact-note">Why it matters: fast structural checks against the canonical lowercase pipeline.</p>
        <p class="muted">Canonical profile: <code>ZL3b-n.txt -> EVAParser -> source_id=&quot;zandbergen_landini&quot; -> load_canonical_lines() + sanitize_token()</code></p>
        <div class="actions">
          <label>Mode
            <select id="validator-mode">
              <option value="syntax">Syntax Only</option>
              <option value="sanitized">Syntax + Sanitized Token Report</option>
              <option value="lattice">Syntax + Lattice Admissibility</option>
            </select>
          </label>
          <label><input id="validator-strict-canonical" type="checkbox" checked> Strict canonical lowercase policy</label>
          <button id="validator-validate">Validate</button>
          <button id="validator-sample">Load Sample</button>
          <button id="validator-clear">Clear</button>
        </div>
        <textarea id="validator-input" rows="14" placeholder="Paste IVTFF lines or content-only lines here..."></textarea>
      </div>
      <div class="two-col">
        <div class="panel">
          <h3>Validation Summary</h3>
          <div id="validator-summary" class="report-box muted">No validation run yet.</div>
          <h3>Line Diagnostics</h3>
          <div id="validator-lines" class="report-box"></div>
        </div>
        <div class="panel">
          <h3>Normalized Output</h3>
          <textarea id="validator-normalized" rows="12" readonly></textarea>
          <h3>Machine Metrics</h3>
          <div id="validator-machine" class="report-box muted">Not evaluated yet.</div>
        </div>
      </div>
    </section>

    <section class="view" id="view-folio">
      <div class="panel">
        <h2>Synthetic Folio Generator</h2>
        <p class="muted compact-note">Why it matters: generate lattice-constrained synthetic lines and immediately test them.</p>
        <div class="control-grid">
          <label>Seed <input id="folio-seed" type="number" value="42"></label>
          <label>Line Count <input id="folio-lines" type="number" min="1" max="200" value="9"></label>
          <label>Min Words/Line <input id="folio-min-words" type="number" min="1" max="50" value="6"></label>
          <label>Max Words/Line <input id="folio-max-words" type="number" min="1" max="60" value="12"></label>
          <label>Start Window (blank=random) <input id="folio-start-window" type="number" min="0" placeholder="auto"></label>
          <label>Folio Label <input id="folio-label" type="text" value="f1000r"></label>
          <label>Scribe Profile
            <select id="folio-profile">
              <option value="hand1">Hand 1</option>
              <option value="hand2">Hand 2</option>
            </select>
          </label>
          <label><input id="folio-canonical-filter" type="checkbox" checked> Canonical lowercase token filter</label>
          <label>Output Format
            <select id="folio-format">
              <option value="content">Content Only</option>
              <option value="ivtff">Full IVTFF Lines</option>
            </select>
          </label>
        </div>
        <div class="actions">
          <button id="folio-generate">Generate Folio</button>
          <button id="folio-generate-validate">Generate -> Validate</button>
        </div>
        <div id="folio-stats" class="report-box muted">No folio generated yet.</div>
        <textarea id="folio-output" rows="14" placeholder="Generated output appears here..." readonly></textarea>
      </div>
    </section>

    <section class="view" id="view-page">
      <div class="panel">
        <h2>Page Generator</h2>
        <p class="muted compact-note">Why it matters: generates folio-conditioned output using schedule offsets and line-count policies, then validates in-place.</p>
        <p id="page-availability" class="muted">Checking page-generator artifact availability...</p>
        <div class="control-grid page-control-grid">
          <label class="page-field-short">Folio ID
            <select id="page-folio-id"></select>
          </label>
          <label>Schedule Mode
            <select id="page-schedule-mode">
              <option value="auto">Auto (line/folio/section/global)</option>
              <option value="global_only">Global Mode Only</option>
            </select>
          </label>
          <label>Line Count Mode
            <select id="page-line-count-mode">
              <option value="observed">Observed Folio Line Count</option>
              <option value="sampled">Sampled From Priors</option>
            </select>
          </label>
          <label class="page-field-tiny">Seed <input id="page-seed" type="number" value="42"></label>
          <label>Scribe Profile
            <select id="page-profile">
              <option value="hand1">Hand 1</option>
              <option value="hand2">Hand 2</option>
            </select>
          </label>
        </div>
        <div class="control-grid page-control-grid page-control-grid-secondary">
          <label class="page-field-short">Min Words/Line <input id="page-min-words" type="number" min="1" max="50" value="6"></label>
          <label class="page-field-short">Max Words/Line <input id="page-max-words" type="number" min="1" max="60" value="12"></label>
          <label class="inline-check"><input id="page-canonical-filter" type="checkbox" checked> Canonical lowercase token filter</label>
          <label>Output Format
            <select id="page-format">
              <option value="content">Content Only</option>
              <option value="ivtff">Full IVTFF Lines</option>
            </select>
          </label>
        </div>
        <div class="actions">
          <button id="page-generate">Generate Page</button>
          <button id="page-generate-validate">Generate -> Validate</button>
        </div>
        <div id="page-status" class="report-box muted">No page generated yet.</div>
        <div id="page-alignment" class="report-box muted">No generated-vs-actual alignment score yet.</div>
        <div class="page-diagnostics-grid">
          <div class="subpanel">
            <h3>Generation Diagnostics</h3>
            <div id="page-diagnostics" class="report-box muted">No diagnostics available.</div>
          </div>
          <div class="subpanel">
            <h3>Folio Scan</h3>
            <div class="scan-panel">
              <a id="page-scan-link" href="#" class="scan-link disabled-link">
                <img id="page-scan-thumb" alt="Folio thumbnail">
              </a>
              <div id="page-scan-meta" class="muted">No scan mapped for selected folio.</div>
            </div>
          </div>
        </div>
        <div class="page-output-grid">
          <div class="subpanel">
            <h3>Generated</h3>
            <p class="muted compact-note">Synthetic output for the selected folio and generation settings.</p>
            <textarea id="page-output" rows="14" placeholder="Generated page output appears here..." readonly></textarea>
          </div>
          <div class="subpanel">
            <h3>Actual Folio</h3>
            <p class="muted compact-note">Directly from the bundled folio dataset for the selected folio and format.</p>
            <textarea id="page-actual-output" rows="14" placeholder="Actual folio content appears here..." readonly></textarea>
          </div>
        </div>
      </div>
    </section>
  </main>

  <aside class="console-panel">
    <h3>Internal Console</h3>
    <div id="debug-console"></div>
  </aside>

  <div id="explorer-scan-modal" class="scan-modal" hidden>
    <div class="scan-modal-dialog" role="dialog" aria-modal="true" aria-label="Folio scan viewer">
      <button id="explorer-scan-close" type="button" class="scan-modal-close" aria-label="Close scan viewer">X</button>
      <img id="explorer-scan-modal-img" alt="Folio scan">
      <div id="explorer-scan-modal-meta" class="scan-modal-meta"></div>
    </div>
  </div>

  <script src="data/slips_data.js"></script>
  <script src="data/lattice_data.js"></script>
  <script src="data/folio_data.js"></script>
  <script src="data/page_schedule_data.js"></script>
  <script src="data/page_priors_data.js"></script>
  <script src="data/metadata.js"></script>

  <script src="js/state.js"></script>
  <script src="js/ui_console.js"></script>
  <script src="js/router.js"></script>
  <script src="js/data_loader.js"></script>

  <script src="js/core/sanitize.js"></script>
  <script src="js/core/ivtff_parser.js"></script>
  <script src="js/core/ivtff_validator.js"></script>
  <script src="js/core/lattice_engine.js"></script>
  <script src="js/core/folio_generator.js"></script>
  <script src="js/core/page_generator.js"></script>

  <script src="js/views/slips_view.js"></script>
  <script src="js/views/lattice_view.js"></script>
  <script src="js/views/folio_explorer_view.js"></script>
  <script src="js/views/validator_view.js"></script>
  <script src="js/views/folio_generator_view.js"></script>
  <script src="js/views/page_generator_view.js"></script>

  <script src="js/app.js"></script>
</body>
</html>
